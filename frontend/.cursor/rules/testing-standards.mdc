---
description: "Frontend testing standards: React Testing Library, Vitest, 70%+ coverage, accessibility testing"
globs: ["frontend/src/**/*.{test,spec}.{js,jsx,ts,tsx}"]
alwaysApply: false
---
# Frontend Testing Standards

## Test Pyramid

You must maintain:
- Unit tests: 70-80% (component and hook tests)
- Integration tests: 15-25% (multi-component flows)
- E2E tests: 5-10% (full user journeys)

## React Testing Library

You must use:
- render(): Render component
- screen: Query rendered output
- userEvent: Simulate user interactions (preferred over fireEvent)
- waitFor(): Wait for async updates
- findBy: Combined query + wait

## Query Priority

You must use in order:
1. getByRole: Semantic HTML roles (BEST)
2. getByLabelText: Form inputs with labels
3. getByPlaceholderText: Input placeholders
4. getByText: Non-interactive content
5. getByTestId: Last resort (data-testid)

You must never use:
- getByClassName
- Direct DOM queries

## Testing Patterns

You must test:
- User interactions (clicks, typing, navigation)
- What user sees (rendered text, elements)
- Accessibility (keyboard nav, screen readers)

You must not test:
- Implementation details (state, props directly)
- Component internals
- Library code (React, hooks)

## Component Testing

You must test:
- Loading states: Render with isLoading=true, verify LoadingSpinner
- Error states: Render with error prop, verify ErrorMessage
- Empty states: Render with empty data, verify EmptyState

## Hook Testing

You must use:
- renderHook(): Extract result and rerender
- Access hook return value via result.current
- Use rerender to update hook props
- Wrap state updates in act()

## Context Testing

You must:
- Create wrapper component with provider
- Pass wrapper to renderHook options
- Test context consumer behavior

## Async Testing

You must use:
- waitFor(): Wait for condition to become true
- findBy queries: Built-in waiting (preferred)
- vi.useFakeTimers(): Enable fake timers
- vi.advanceTimersByTime(ms): Fast-forward time
- vi.useRealTimers(): Restore after test

## Coverage Requirements

You must achieve:
- Components: 70%+ line coverage
- Custom hooks: 80%+ line coverage

You must measure:
- Run: npm run test:coverage
- Report: frontend/coverage/lcov-report/index.html

## Mocking

You must:
- Mock API calls: vi.mock() at module level
- Use mockResolvedValue() for async returns
- Use mockRejectedValue() for errors
- Create mock context object for Context testing
- Enable fake timers for debounce/throttle testing

## Best Practices

You must ensure:
- Test behavior, not implementation
- User-centric testing (what user experiences)
- Use getByRole for accessibility
- Independent tests (no interdependencies)
- Fast execution (quick feedback loop)
- Clear failures (descriptive expectations)

## Minimal Testing Philosophy

You must follow:
- Test what matters: Focus on user interactions, rendered output, and accessibility
- Avoid over-testing: Skip implementation details, internal state, and unlikely edge cases
- Keep tests simple: One focused behavior per test
- Avoid redundancy: If one test verifies rendering, don't add a separate "renders correctly" test
- Remove obsolete tests: Delete tests for removed features immediately

You must avoid:
- Testing every prop variation (test meaningful combinations only)
- Testing library code (React, hooks, third-party libraries)
- Testing multiple behaviors in one test (split them)
- Testing that something renders AND does something (separate concerns)
