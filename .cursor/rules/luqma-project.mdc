---
description: "Luqma project context: Recipe search application with Spring Boot backend and React frontend"
alwaysApply: true
---
# Luqma Project Context

## Overview

Recipe search application with nutritional information and dynamic ingredient exclusion.

## Tech Stack

**Backend:** Spring Boot 3.5.7, Java 25, Gradle, Spoonacular API, JaCoCo

**Frontend:** React 19.2.0, Vite 7.2.2, TailwindCSS 4.1.17, React Router 7.9.5, Context API, Vitest

## Architecture

**Security (Critical):**
- Backend proxies all Spoonacular API calls
- Frontend calls backend only, never external APIs
- API keys never in frontend or version control

**Data Flow:** User → React UI → Backend API → Spoonacular

**Backend Structure** (`backend/src/main/java/app/luqma/backend/`):
- controller/: ✅ REST endpoints (RecipeController)
- service/: ✅ Business logic (RecipeSearchService, RecipeDetailService, IngredientValidationService, NutritionCalculationService)
- filter/: ✅ Servlet filters (RateLimitFilter)
- client/: ✅ Spoonacular API client (SpoonacularClient with RestClient)
- repository/: ✅ Data access (RecipeRepository with Spring Cache)
- mapper/: ✅ Object mapping (RecipeMapper, NutrientExtractor)
- model/dto/: ✅ API request/response DTOs (RecipeSearchResponse, RecipeSummary, RecipeDetailResponse, IngredientDTO, NutritionDTO, ExcludeIngredientsRequest) + Spoonacular DTOs
- model/domain/: ✅ Internal domain models (RecipeDetail, ExtendedIngredient, NutritionInfo, Nutrient, AnalyzedInstruction, InstructionStep)
- config/: ✅ Spring configuration (CORS, Security, Rate Limiting, RecipeSearch properties, Spoonacular, Cache)
- exception/: ✅ Custom exceptions + GlobalExceptionHandler with comprehensive error handling (including ExternalApiException)
- constants/: ✅ Application constants (ErrorMessages, NutrientNames)
- util/: ✅ Utility classes (StringSanitizer, MockDataLoader, CollectionUtils, DefaultValue)

**Frontend Structure** (`frontend/src/`):
- pages/: Route pages with feature-based organization
  - about/: AboutPage.jsx, FeatureCard, FeaturesSection, MissionSection
  - recipe/: RecipePage with features subdirectory
    - features/detail/: RecipeDetail, RecipeHeader, RecipeImage, RecipeMetadata components
    - features/exclusion/: IngredientExclusionPanel (Desktop/Mobile variants), ExcludedIngredientsList
    - features/nutrition/: CollapsibleNutrition, NutritionCard, NutritionContent
    - ingredients/: IngredientList
  - HomePage.jsx
- components/: Shared components
  - layout/: Header (with mobile menu components), Footer, HeroSection, SkipLink, Container
  - recipe/: card/ (RecipeCard, RecipeGrid), ingredients/ (IngredientItem), instructions/ (InstructionStep), nutrition/
  - search/: SearchBar, SearchResults, Pagination (with subcomponents), ResultsHeader
  - ui/: UI primitives (Button, Card, Alert, LoadingSpinner, Badge, Typography, Collapsible, LiveRegion, Skeleton, Checkbox)
- contexts/: React Context providers (RecipeExclusionContext)
- hooks/: Custom hooks
  - State & Data: useImageFallback, useMobileMenu, usePaginationLogic, useRecipeDetail, useSearch, useSearchRecipes, useSearchState, useApiMutation
  - Accessibility: useKeyboardNavigation (grid navigation, shortcuts, focus trap)
- services/: ✅ API client (apiClient.js with searchRecipes, getRecipeById, excludeIngredients)
- utils/: Helper functions (httpClient, iconRegistry, colorUtils, logger)
- constants/: ✅ Application constants (api, ui, validation)
- test/: Test files and mocks/

**Development Approach:**
- Backend integrates with Spoonacular API via SpoonacularClient for live data
- Spring Cache (Caffeine) caches recipe details for 1 hour (max 500 recipes, LRU eviction)
- Mock data in `backend/src/main/resources/mocks/` used only for unit and integration tests
- Comprehensive error handling for rate limits (429), network errors, and API failures
- Frontend connects to backend API for all data
- Spoonacular API key secured in backend environment variables only

## API Endpoints

**Backend REST API:**
- ✅ GET /api/v1/recipes/search - Search recipes with pagination (query, page, pageSize params)
- ✅ GET /api/v1/recipes/{id} - Get recipe details with ingredients, nutrition, and instructions
- ✅ POST /api/v1/recipes/{id}/exclude-ingredients - Exclude ingredients and recalculate nutrition

**Health & Monitoring:**
- GET /actuator/health - Health check
- GET /actuator/health/liveness - Liveness probe
- GET /actuator/health/readiness - Readiness probe
- GET /actuator/info - Application info

**API Documentation:**
- Swagger UI: ${BACKEND_URL}/swagger-ui.html (when running)

**Spoonacular API (external API used in backend only):**
- GET /recipes/complexSearch
- GET /recipes/{id}/information
- GET /food/ingredients/{id}/information

## Environment Variables

**Backend (`backend/.env`):**
- SPOONACULAR_API_KEY (required)
- SPRING_PROFILES_ACTIVE (optional, defaults to `dev`)

**Frontend (`frontend/.env`):**
- LUQMA_API_URL (Backend API endpoint, default: `http://localhost:8080/api/v1`)

## Commands

**Backend:**
- ./gradlew bootRun (run with dev profile)
- npm run dev:backend (from root)
- ./gradlew test

**Frontend:**
- npm run dev (from root, starts at http://localhost:3000)
- npm run dev:frontend (from root)
- cd frontend && npm run dev
- npm run build
- npm test
- npm run lint:fix

## Architectural Patterns

**Backend (ADR-0009):**
- Layered: Controller → Service → Repository → Client
- Controllers: HTTP concerns only
- Services: Business logic
- Repositories: Data access with caching
- Clients: External API integration (SpoonacularClient)

**Frontend:**
- Feature-based organization (ADR-0007): pages/{page}/features/{feature}/
- Custom hooks for logic (ADR-0008): useRecipeDetail, useSearch, etc.
- Context API for cross-component state (ADR-0004): RecipeExclusionContext
- URL state for search (ADR-0005): shareable URLs, 300ms debounce

**Spoonacular Integration:**
- SpoonacularClient implemented with RestClient (Spring 6.2)
- Recipe search via complexSearch endpoint with titleMatch parameter
- Recipe details with nutrition via information endpoint
- Spring Cache (Caffeine) for performance optimization
- Mock data retained for testing purposes

## Documentation

**ADRs:** docs/decisions/ (MADR format) - 10 architectural decisions

**Standards:** .cursor/rules/ (root), backend/.cursor/rules/, frontend/.cursor/rules/

**Key Principles:**
- Separation of concerns
- Simplicity over complexity
- Security first (API keys, WCAG 2.1 AA)
- Independent testability
- Accessibility first (WCAG 2.1 AA, keyboard navigation, screen readers)
